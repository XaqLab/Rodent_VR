from matplotlib import pyplot as plot
from numpy import array, pi
from numpy.linalg import norm

# import from a relative directory
import sys
sys.path.append("..") # in case this file is run from .
sys.path.append(".")  # in case this file is run from ..
from dome_projection import flat_display_direction



required_accuracy = 0.000001

PROJECTOR_PIXEL_WIDTH = 1280
PROJECTOR_PIXEL_HEIGHT = 720

screen_width = 16
screen_height = 9
distance_to_screen = 25


# test the basic setup, no pitch, yaw, or roll, and no vertical_offset
basic_results = array([
    [-0.30019172, 0.93883259, 0.16875516],
    [-0.26545878, 0.94891433, 0.17056735],
    [-0.22966096, 0.95791851, 0.17218585],
    [-0.19290649, 0.96573962, 0.1735917,],
    [-0.15532197, 0.97228153, 0.1747676,],
    [-0.1170509,  0.97746054, 0.17569853],
    [-0.07825136, 0.98120822, 0.17637218],
    [-0.03909308, 0.98347383, 0.17677942],
    [  2.46056541e-04,  9.84226166e-01,  1.76914653e-01],
    [ 0.03958406, 0.9834548,  0.176776, ],
    [ 0.07873893, 0.98117044, 0.17636539],
    [ 0.11753289, 0.97740451, 0.17568846],
    [ 0.15579633, 0.97220801, 0.17475439],
    [ 0.19337132, 0.96564956, 0.17357551],
    [ 0.23011459, 0.95781305, 0.1721669,],
    [ 0.26589972, 0.94879473, 0.17054585],
    [-0.30189688, 0.94416537, 0.13194711],
    [-0.26699949, 0.95442178, 0.13338044],
    [-0.23101954, 0.96358517, 0.13466103],
    [-0.19406652, 0.97154706, 0.1357737,],
    [-0.15626881, 0.97820852, 0.13670464],
    [-0.11777213, 0.98348334, 0.1374418,],
    [-0.07873725, 0.987301,   0.13797531],
    [-0.03933696, 0.98960916, 0.13829788],
    [  2.47593921e-04,  9.90375683e-01,  1.38405002e-01],
    [ 0.03983099, 0.98958978, 0.13829517],
    [ 0.07922782, 0.9872625,  0.13796993],
    [ 0.11825701, 0.98342627, 0.13743382],
    [ 0.15674592, 0.97813364, 0.13669418],
    [ 0.19453394, 0.97145537, 0.13576089],
    [ 0.23147555, 0.96347782, 0.13464603],
    [ 0.2674426,  0.95430008, 0.13336344],
    [-0.3031943,  0.94822299, 0.09458524],
    [-0.26817217, 0.95861367, 0.09562171],
    [-0.23205391, 0.96789952, 0.09654798],
    [-0.19494995, 0.97596973, 0.09735298],
    [-0.15699003, 0.98272321, 0.09802664],
    [-0.1183216,  0.98807181, 0.09856016],
    [-0.07910748, 0.99194336, 0.09894635],
    [-0.0395228,  0.99428432, 0.09917986],
    [  2.48765440e-04,  9.95061759e-01,  9.92574105e-02],
    [ 0.04001915, 0.99426466, 0.0991779,],
    [ 0.07960032, 0.99190432, 0.09894246],
    [ 0.11880868, 0.98801393, 0.09855439],
    [ 0.15746923, 0.98264729, 0.09801907],
    [ 0.19541933, 0.97587678, 0.09734371],
    [ 0.23251172, 0.96779072, 0.09653712],
    [ 0.26861693, 0.95849037, 0.09560941],
    [-0.30406769, 0.95095446, 0.05681953],
    [-0.26896177, 0.96143619, 0.05744581],
    [-0.23275052, 0.9708051,  0.0580056,],
    [-0.19554503, 0.97894883, 0.05849219],
    [-0.15747592, 0.98576477, 0.05889945],
    [-0.11869182, 0.99116346, 0.05922202],
    [-0.07935696, 0.99507161, 0.05945553],
    [-0.03964803, 0.99743484, 0.05959673],
    [  2.49554926e-04,  9.98219703e-01,  5.96436273e-02],
    [ 0.04014595, 0.997415,   0.05959555],
    [ 0.07985133, 0.9950322,  0.05945317],
    [ 0.11918038, 0.99110504, 0.05921853],
    [ 0.15795653, 0.98568815, 0.05889487],
    [ 0.19601572, 0.97885502, 0.05848659],
    [ 0.23320955, 0.97069533, 0.05799905],
    [ 0.26940763, 0.96131179, 0.05743838],
    [-0.30450584, 0.95232475, 0.01880841],
    [-0.26935795, 0.96285236, 0.01901633],
    [-0.23310009, 0.97226315, 0.0192022,],
    [-0.19584367, 0.98044393, 0.01936377],
    [-0.1577198,  0.98729137, 0.019499, ],
    [-0.11887766, 0.99271532, 0.01960613],
    [-0.07948219, 0.99664193, 0.01968368],
    [-0.0397109,  0.99901639, 0.01973057],
    [  2.49951249e-04,  9.99804995e-01,  1.97461486e-02],
    [ 0.04020961, 0.99899645, 0.01973018],
    [ 0.07997734, 0.99660233, 0.0196829,],
    [ 0.11936696, 0.99265662, 0.01960497],
    [ 0.15820111, 0.98721439, 0.01949748],
    [ 0.19631503, 0.9803497,  0.01936191],
    [ 0.23355973, 0.97215288, 0.01920002],
    [ 0.26980436, 0.96272742, 0.01901387],
    [-0.30450308, 0.95231612,-0.0192844,],
    [-0.26935545, 0.96284344,-0.01949758],
    [-0.23309789, 0.97225395,-0.01968814],
    [-0.19584179, 0.98043451,-0.0198538,],
    [-0.15771826, 0.98728175,-0.01999246],
    [-0.11887649, 0.99270553,-0.02010229],
    [-0.0794814,  0.99663203,-0.0201818,],
    [-0.03971051, 0.99900642,-0.02022988],
    [  2.49948750e-04,  9.99795001e-01, -2.02458488e-02],
    [ 0.04020921, 0.99898648,-0.02022948],
    [ 0.07997654, 0.99659243,-0.020181, ],
    [ 0.11936578, 0.99264684,-0.0201011,],
    [ 0.15819956, 0.98720477,-0.0199909,],
    [ 0.19631314, 0.98034027,-0.01985189],
    [ 0.23355752, 0.97214369,-0.01968591],
    [ 0.26980186, 0.96271849,-0.01949505],
    [-0.30405944, 0.95092866,-0.05729345],
    [-0.26895432, 0.96140953,-0.05792492],
    [-0.23274394, 0.97077765,-0.05848935],
    [-0.19553941, 0.97892068,-0.05897997],
    [-0.15747133, 0.98573604,-0.0593906,],
    [-0.11868833, 0.99113425,-0.05971584],
    [-0.0793546,  0.99504205,-0.05995128],
    [-0.03964685, 0.99740507,-0.06009366],
    [  2.49547466e-04,  9.98189864e-01, -6.01409393e-02],
    [ 0.04014476, 0.99738523,-0.06009246],
    [ 0.07984896, 0.99500265,-0.05994891],
    [ 0.11917687, 0.99107584,-0.05971232],
    [ 0.15795192, 0.98565942,-0.05938598],
    [ 0.19601008, 0.97882689,-0.05897432],
    [ 0.23320296, 0.97066789,-0.05848274],
    [ 0.26940016, 0.96128514,-0.05791743],
    [-0.30318067, 0.94818037,-0.09505508],
    [-0.26815985, 0.95856963,-0.09609661],
    [-0.23204304, 0.96785418,-0.09702738],
    [-0.19494067, 0.97592325,-0.09783631],
    [-0.15698245, 0.98267576,-0.09851324],
    [-0.11831582, 0.98802358,-0.09904936],
    [-0.07910359, 0.99189456,-0.09943743],
    [-0.03952085, 0.99423517,-0.09967208],
    [  2.48753125e-04,  9.95012500e-01, -9.97500031e-02],
    [ 0.04001717, 0.99421552,-0.09967011],
    [ 0.07959641, 0.99185553,-0.09943352],
    [ 0.11880288, 0.98796571,-0.09904356],
    [ 0.15746163, 0.98259986,-0.09850564],
    [ 0.19541002, 0.97583032,-0.09782699],
    [ 0.23250083, 0.9677454, -0.09701648],
    [ 0.26860459, 0.95844634,-0.09608425],
    [-0.30187804, 0.94410645,-0.13241093],
    [-0.26698247, 0.95436092,-0.13384912],
    [-0.23100453, 0.96352255,-0.13513404],
    [-0.1940537,  0.97148287,-0.13625047],
    [-0.15625834, 0.978143,  -0.13718456],
    [-0.11776416, 0.98341676,-0.1379242,],
    [-0.07873188, 0.98723364,-0.13845952],
    [-0.03933427, 0.98954133,-0.13878317],
    [  2.47576923e-04,  9.90307692e-01, -1.38890654e-01],
    [ 0.03982826, 0.98952195,-0.13878045],
    [ 0.07922241, 0.98719515,-0.13845412],
    [ 0.118249,  0.9833597,-0.1379162],
    [ 0.15673542, 0.97806814,-0.13717406],
    [ 0.19452109, 0.9713912, -0.13623762],
    [ 0.23146051, 0.96341522,-0.13511899],
    [ 0.26742555, 0.95423925,-0.13383206]])


counter = 0
for row in range(0, PROJECTOR_PIXEL_HEIGHT - 1, 80):
    for column in range(0, PROJECTOR_PIXEL_WIDTH - 1, 80):
        result = flat_display_direction(row, column, screen_height,
                                        screen_width, PROJECTOR_PIXEL_HEIGHT,
                                        PROJECTOR_PIXEL_WIDTH,
                                        distance_to_screen, vertical_offset=0,
                                        pitch=0, yaw=0, roll=0)
        if norm(result - basic_results[counter]) > required_accuracy:
            print "Mismatch on direction for pixel (%d, %d)" % (row, column)
            print "Old result:", basic_results[counter]
            print "New result:", result
        counter = counter + 1
#print "Done with basic flat_display_direction test"

# vertical_offset, but no pitch or yaw
vertical_offset_results = array([
    [-0.29809971, 0.93228995, 0.20487072],
    [-0.26356931, 0.94216017, 0.2070397,],
    [-0.22799546, 0.95097166, 0.20897602],
    [-0.19148484, 0.95862248, 0.21065729],
    [-0.15416192, 0.96501986, 0.21206311],
    [-0.11616745, 0.9700831,  0.21317576],
    [-0.07765626, 0.97374624, 0.21398074],
    [-0.03879443, 0.97596043, 0.21446731],
    [  2.44173912e-04,  9.76695648e-01,  2.14628869e-01],
    [ 0.03928166, 0.97594184, 0.21446322],
    [ 0.07814017, 0.97370932, 0.21397262],
    [ 0.11664591, 0.97002833, 0.21316373],
    [ 0.15463291, 0.96494798, 0.21204732],
    [ 0.19194651, 0.9585344,  0.21063793],
    [ 0.22844615, 0.95086847, 0.20895335],
    [ 0.26400758, 0.94204311, 0.20701397],
    [-0.30019172, 0.93883259, 0.16875516],
    [-0.26545878, 0.94891433, 0.17056735],
    [-0.22966096, 0.95791851, 0.17218585],
    [-0.19290649, 0.96573962, 0.1735917,],
    [-0.15532197, 0.97228153, 0.1747676,],
    [-0.1170509,  0.97746054, 0.17569853],
    [-0.07825136, 0.98120822, 0.17637218],
    [-0.03909308, 0.98347383, 0.17677942],
    [  2.46056541e-04,  9.84226166e-01,  1.76914653e-01],
    [ 0.03958406, 0.9834548,  0.176776, ],
    [ 0.07873893, 0.98117044, 0.17636539],
    [ 0.11753289, 0.97740451, 0.17568846],
    [ 0.15579633, 0.97220801, 0.17475439],
    [ 0.19337132, 0.96564956, 0.17357551],
    [ 0.23011459, 0.95781305, 0.1721669,],
    [ 0.26589972, 0.94879473, 0.17054585],
    [-0.30189688, 0.94416537, 0.13194711],
    [-0.26699949, 0.95442178, 0.13338044],
    [-0.23101954, 0.96358517, 0.13466103],
    [-0.19406652, 0.97154706, 0.1357737,],
    [-0.15626881, 0.97820852, 0.13670464],
    [-0.11777213, 0.98348334, 0.1374418,],
    [-0.07873725, 0.987301,   0.13797531],
    [-0.03933696, 0.98960916, 0.13829788],
    [  2.47593921e-04,  9.90375683e-01,  1.38405002e-01],
    [ 0.03983099, 0.98958978, 0.13829517],
    [ 0.07922782, 0.9872625,  0.13796993],
    [ 0.11825701, 0.98342627, 0.13743382],
    [ 0.15674592, 0.97813364, 0.13669418],
    [ 0.19453394, 0.97145537, 0.13576089],
    [ 0.23147555, 0.96347782, 0.13464603],
    [ 0.2674426,  0.95430008, 0.13336344],
    [-0.3031943,  0.94822299, 0.09458524],
    [-0.26817217, 0.95861367, 0.09562171],
    [-0.23205391, 0.96789952, 0.09654798],
    [-0.19494995, 0.97596973, 0.09735298],
    [-0.15699003, 0.98272321, 0.09802664],
    [-0.1183216,  0.98807181, 0.09856016],
    [-0.07910748, 0.99194336, 0.09894635],
    [-0.0395228,  0.99428432, 0.09917986],
    [  2.48765440e-04,  9.95061759e-01,  9.92574105e-02],
    [ 0.04001915, 0.99426466, 0.0991779,],
    [ 0.07960032, 0.99190432, 0.09894246],
    [ 0.11880868, 0.98801393, 0.09855439],
    [ 0.15746923, 0.98264729, 0.09801907],
    [ 0.19541933, 0.97587678, 0.09734371],
    [ 0.23251172, 0.96779072, 0.09653712],
    [ 0.26861693, 0.95849037, 0.09560941],
    [-0.30406769, 0.95095446, 0.05681953],
    [-0.26896177, 0.96143619, 0.05744581],
    [-0.23275052, 0.9708051,  0.0580056,],
    [-0.19554503, 0.97894883, 0.05849219],
    [-0.15747592, 0.98576477, 0.05889945],
    [-0.11869182, 0.99116346, 0.05922202],
    [-0.07935696, 0.99507161, 0.05945553],
    [-0.03964803, 0.99743484, 0.05959673],
    [  2.49554926e-04,  9.98219703e-01,  5.96436273e-02],
    [ 0.04014595, 0.997415,   0.05959555],
    [ 0.07985133, 0.9950322,  0.05945317],
    [ 0.11918038, 0.99110504, 0.05921853],
    [ 0.15795653, 0.98568815, 0.05889487],
    [ 0.19601572, 0.97885502, 0.05848659],
    [ 0.23320955, 0.97069533, 0.05799905],
    [ 0.26940763, 0.96131179, 0.05743838],
    [-0.30450584, 0.95232475, 0.01880841],
    [-0.26935795, 0.96285236, 0.01901633],
    [-0.23310009, 0.97226315, 0.0192022,],
    [-0.19584367, 0.98044393, 0.01936377],
    [-0.1577198,  0.98729137, 0.019499, ],
    [-0.11887766, 0.99271532, 0.01960613],
    [-0.07948219, 0.99664193, 0.01968368],
    [-0.0397109,  0.99901639, 0.01973057],
    [  2.49951249e-04,  9.99804995e-01,  1.97461486e-02],
    [ 0.04020961, 0.99899645, 0.01973018],
    [ 0.07997734, 0.99660233, 0.0196829,],
    [ 0.11936696, 0.99265662, 0.01960497],
    [ 0.15820111, 0.98721439, 0.01949748],
    [ 0.19631503, 0.9803497,  0.01936191],
    [ 0.23355973, 0.97215288, 0.01920002],
    [ 0.26980436, 0.96272742, 0.01901387],
    [-0.30450308, 0.95231612,-0.0192844,],
    [-0.26935545, 0.96284344,-0.01949758],
    [-0.23309789, 0.97225395,-0.01968814],
    [-0.19584179, 0.98043451,-0.0198538,],
    [-0.15771826, 0.98728175,-0.01999246],
    [-0.11887649, 0.99270553,-0.02010229],
    [-0.0794814,  0.99663203,-0.0201818,],
    [-0.03971051, 0.99900642,-0.02022988],
    [  2.49948750e-04,  9.99795001e-01, -2.02458488e-02],
    [ 0.04020921, 0.99898648,-0.02022948],
    [ 0.07997654, 0.99659243,-0.020181, ],
    [ 0.11936578, 0.99264684,-0.0201011,],
    [ 0.15819956, 0.98720477,-0.0199909,],
    [ 0.19631314, 0.98034027,-0.01985189],
    [ 0.23355752, 0.97214369,-0.01968591],
    [ 0.26980186, 0.96271849,-0.01949505],
    [-0.30405944, 0.95092866,-0.05729345],
    [-0.26895432, 0.96140953,-0.05792492],
    [-0.23274394, 0.97077765,-0.05848935],
    [-0.19553941, 0.97892068,-0.05897997],
    [-0.15747133, 0.98573604,-0.0593906,],
    [-0.11868833, 0.99113425,-0.05971584],
    [-0.0793546,  0.99504205,-0.05995128],
    [-0.03964685, 0.99740507,-0.06009366],
    [  2.49547466e-04,  9.98189864e-01, -6.01409393e-02],
    [ 0.04014476, 0.99738523,-0.06009246],
    [ 0.07984896, 0.99500265,-0.05994891],
    [ 0.11917687, 0.99107584,-0.05971232],
    [ 0.15795192, 0.98565942,-0.05938598],
    [ 0.19601008, 0.97882689,-0.05897432],
    [ 0.23320296, 0.97066789,-0.05848274],
    [ 0.26940016, 0.96128514,-0.05791743],
    [-0.30318067, 0.94818037,-0.09505508],
    [-0.26815985, 0.95856963,-0.09609661],
    [-0.23204304, 0.96785418,-0.09702738],
    [-0.19494067, 0.97592325,-0.09783631],
    [-0.15698245, 0.98267576,-0.09851324],
    [-0.11831582, 0.98802358,-0.09904936],
    [-0.07910359, 0.99189456,-0.09943743],
    [-0.03952085, 0.99423517,-0.09967208],
    [  2.48753125e-04,  9.95012500e-01, -9.97500031e-02],
    [ 0.04001717, 0.99421552,-0.09967011],
    [ 0.07959641, 0.99185553,-0.09943352],
    [ 0.11880288, 0.98796571,-0.09904356],
    [ 0.15746163, 0.98259986,-0.09850564],
    [ 0.19541002, 0.97583032,-0.09782699],
    [ 0.23250083, 0.9677454, -0.09701648],
    [ 0.26860459, 0.95844634,-0.09608425]])


counter = 0
for row in range(0, PROJECTOR_PIXEL_HEIGHT - 1, 80):
    for column in range(0, PROJECTOR_PIXEL_WIDTH - 1, 80):
        #result = old_fun(row, column, screen_height,
        result = flat_display_direction(row, column, screen_height,
                                        screen_width, PROJECTOR_PIXEL_HEIGHT,
                                        PROJECTOR_PIXEL_WIDTH,
                                        distance_to_screen, vertical_offset=1,
                                        pitch=0, yaw=0, roll=0)
        if norm(result - vertical_offset_results[counter]) > required_accuracy:
            print "Mismatch on direction for pixel (%d, %d)" % (row, column)
            print "Old result:", vertical_offset_results[counter]
            print "New result:", result
        counter = counter + 1
#print "Done with vertical offset test"


# pitch and yaw, no vertical offset
pitch_and_yaw_results = array([
    [ 0.72867529, 0.30019172, 0.61556255],
    [ 0.73650024, 0.26545878, 0.62217283],
    [ 0.74348884, 0.22966096, 0.62807658],
    [ 0.74955919, 0.19290649, 0.63320463],
    [ 0.7546367,  0.15532197, 0.63749395],
    [ 0.75865639, 0.1170509,  0.64088966],
    [ 0.76156516, 0.07825136, 0.6433469,],
    [ 0.76332361, 0.03909308, 0.64483238],
    [  7.63907536e-01, -2.46056541e-04,  6.45325667e-01],
    [ 0.76330884,-0.03958406, 0.64481991],
    [ 0.76153583,-0.07873893, 0.64332212],
    [ 0.75861291,-0.11753289, 0.64085293],
    [ 0.75457964,-0.15579633, 0.63744574],
    [ 0.7494893, -0.19337132, 0.63314558],
    [ 0.74340699,-0.23011459, 0.62800743],
    [ 0.73640742,-0.26589972, 0.62209441],
    [ 0.75169764, 0.30189688, 0.58635223],
    [ 0.75986328, 0.26699949, 0.59272174],
    [ 0.76715872, 0.23101954, 0.59841246],
    [ 0.77349758, 0.19406652, 0.603357, ],
    [ 0.7788011,  0.15626881, 0.60749395],
    [ 0.78300066, 0.11777213, 0.61076976],
    [ 0.78604009, 0.07873725, 0.61314063],
    [ 0.78787774, 0.03933696, 0.61457406],
    [  7.88488000e-01, -2.47593921e-04,  6.15050089e-01],
    [ 0.7878623, -0.03983099, 0.61456202],
    [ 0.78600944,-0.07922782, 0.61311672],
    [ 0.78295522,-0.11825701, 0.61073431],
    [ 0.77874149,-0.15674592, 0.60744745],
    [ 0.77342458,-0.19453394, 0.60330006],
    [ 0.76707326,-0.23147555, 0.59834579],
    [ 0.7597664, -0.2674426,  0.59264617],
    [ 0.77389258, 0.3031943,  0.55602472],
    [ 0.78237294, 0.26817217, 0.56211767],
    [ 0.78995158, 0.23205391, 0.56756276],
    [ 0.79653809, 0.19494995, 0.57229502],
    [ 0.80204994, 0.15699003, 0.57625517],
    [ 0.8064152,  0.1183216,  0.57939151],
    [ 0.80957497, 0.07910748, 0.58166173],
    [ 0.81148555, 0.0395228,  0.58303444],
    [  8.12120057e-01, -2.48765440e-04,  5.83490319e-01],
    [ 0.8114695, -0.04001915, 0.58302291],
    [ 0.80954311,-0.07960032, 0.58163884],
    [ 0.80636797,-0.11880868, 0.57935757],
    [ 0.80198799,-0.15746923, 0.57621065],
    [ 0.79646223,-0.19541933, 0.57224051],
    [ 0.78986279,-0.23251172, 0.56749896],
    [ 0.7822723, -0.26861693, 0.56204537],
    [ 0.79514095, 0.30406769, 0.52468438],
    [ 0.80390526, 0.26896177, 0.53046763],
    [ 0.81173908, 0.23275052, 0.53563688],
    [ 0.81854846, 0.19554503, 0.54013014],
    [ 0.82424761, 0.15747592, 0.5438908,],
    [ 0.82876173, 0.11869182, 0.5468695,],
    [ 0.83202953, 0.07935696, 0.5490258,],
    [ 0.83400555, 0.03964803, 0.5503297,],
    [  8.34661808e-01, -2.49554926e-04,  5.50762748e-01],
    [ 0.83398895,-0.04014595, 0.55031875],
    [ 0.83199658,-0.07985133, 0.54900406],
    [ 0.82871288,-0.11918038, 0.54683727],
    [ 0.82418355,-0.15795653, 0.54384853],
    [ 0.81847002,-0.19601572, 0.54007838],
    [ 0.81164729,-0.23320955, 0.53557631],
    [ 0.80380124,-0.26940763, 0.53039899],
    [ 0.81533322, 0.30450584, 0.49245094],
    [ 0.82434644, 0.26935795, 0.49789481],
    [ 0.83240348, 0.23310009, 0.50276116],
    [ 0.83940747, 0.19584367, 0.50699148],
    [ 0.84526991, 0.1577198,  0.51053232],
    [ 0.84991362, 0.11887766, 0.51333706],
    [ 0.85327539, 0.07948219, 0.51536753],
    [ 0.85530829, 0.0397109,  0.51659537],
    [  8.55983450e-01, -2.49951249e-04,  5.17003164e-01],
    [ 0.85529121,-0.04020961, 0.51658506],
    [ 0.85324149,-0.07997734, 0.51534705],
    [ 0.84986337,-0.11936696, 0.51330671],
    [ 0.845204,  -0.15820111, 0.51049251],
    [ 0.83932679,-0.19631503, 0.50694275],
    [ 0.83230908,-0.23355973, 0.50270414],
    [ 0.82423947,-0.26980436, 0.4978302,],
    [ 0.83437215, 0.30450308, 0.45945728],
    [ 0.84359567, 0.26935545, 0.46453632],
    [ 0.8518407,  0.23309789, 0.46907655],
    [ 0.85900809, 0.19584179, 0.47302336],
    [ 0.8650073,  0.15771826, 0.4763269,],
    [ 0.86975936, 0.11887649, 0.47894368],
    [ 0.87319955, 0.0794814,  0.48083806],
    [ 0.87527988, 0.03971051, 0.48198362],
    [  8.75970793e-01, -2.49948750e-04,  4.82364081e-01],
    [ 0.87526241,-0.04020921, 0.481974, ],
    [ 0.87316486,-0.07997654, 0.48081896],
    [ 0.86970793,-0.11936578, 0.47891536],
    [ 0.86493986,-0.15819956, 0.47628976],
    [ 0.85892553,-0.19631314, 0.4729779,],
    [ 0.85174408,-0.23355752, 0.46902335],
    [ 0.8434862, -0.26980186, 0.46447604],
    [ 0.8521751,  0.30405944, 0.42584675],
    [ 0.86156754, 0.26895432, 0.43054031],
    [ 0.86996279, 0.23274394, 0.43473556],
    [ 0.87726017, 0.19553941, 0.43838219],
    [ 0.88336775, 0.15747133, 0.44143425],
    [ 0.88820536, 0.11868833, 0.44385169],
    [ 0.89170734, 0.0793546,  0.44560169],
    [ 0.89382496, 0.03964685, 0.4466599,],
    [  8.94528250e-01, -2.49547466e-04,  4.47011351e-01],
    [ 0.89380718,-0.04014476, 0.44665102],
    [ 0.89167203,-0.07984896, 0.44558405],
    [ 0.88815301,-0.11917687, 0.44382553],
    [ 0.88329909,-0.15795192, 0.44139994],
    [ 0.87717611,-0.19601008, 0.43834018],
    [ 0.86986442,-0.23320296, 0.43468641],
    [ 0.86145607,-0.26940016, 0.43048461],
    [ 0.86867583, 0.30318067, 0.39177007],
    [ 0.87819395, 0.26815985, 0.39606271],
    [ 0.8867,     0.23204304, 0.39989891],
    [ 0.89409248, 0.19494067, 0.4032329,],
    [ 0.90027879, 0.15698245, 0.40602291],
    [ 0.9051782,  0.11831582, 0.40823252],
    [ 0.9087246,  0.07910359, 0.40983194],
    [ 0.91086896, 0.03952085, 0.41079904],
    [  9.11581104e-01, -2.48753125e-04,  4.11120213e-01],
    [ 0.91085095,-0.04001717, 0.41079092],
    [ 0.90868884,-0.07959641, 0.40981581],
    [ 0.90512519,-0.11880288, 0.40820861],
    [ 0.90020925,-0.15746163, 0.40599154],
    [ 0.89400734,-0.19541002, 0.4031945,],
    [ 0.88660034,-0.23250083, 0.39985397],
    [ 0.878081,  -0.26860459, 0.39601177],
    [ 0.88382564, 0.30187804, 0.357382, ],
    [ 0.89342537, 0.26698247, 0.36126372],
    [ 0.90200202, 0.23100453, 0.36473176],
    [ 0.90945408, 0.1940537,  0.36774506],
    [ 0.91568896, 0.15625834, 0.37026619],
    [ 0.92062599, 0.11776416, 0.37226252],
    [ 0.92419917, 0.07873188, 0.37370736],
    [ 0.92635952, 0.03933427, 0.37458091],
    [  9.27076946e-01, -2.47576923e-04,  3.74871011e-01],
    [ 0.92634138,-0.03982826, 0.37457358],
    [ 0.92416314,-0.07922241, 0.37369279],
    [ 0.92057258,-0.118249,   0.37224092],
    [ 0.91561888,-0.15673542, 0.37023785],
    [ 0.90936826,-0.19452109, 0.36771036],
    [ 0.90190155,-0.23146051, 0.36469114],
    [ 0.89331146,-0.26742555, 0.36121767]])


counter = 0
for row in range(0, PROJECTOR_PIXEL_HEIGHT - 1, 80):
    for column in range(0, PROJECTOR_PIXEL_WIDTH - 1, 80):
        result = flat_display_direction(row, column, screen_height,
                                        screen_width, PROJECTOR_PIXEL_HEIGHT,
                                        PROJECTOR_PIXEL_WIDTH,
                                        distance_to_screen, vertical_offset=0,
                                        pitch=30*pi/180, yaw=90*pi/180, roll=0)
        if norm(result - pitch_and_yaw_results[counter]) > required_accuracy:
            print "Mismatch on direction for pixel (%d, %d)" % (row, column)
            print "Old result:", pitch_and_yaw_results[counter]
            print "New result:", result
        counter = counter + 1
#print "Done with pitch and yaw test"

print "Done with flat_display_direction test"

